---
lab:
    title: '서비스 인스턴스를 전체 Azure 솔루션의 구성 요소로 배포'
    module: '모듈 2: Azure 플랫폼에서 사용 가능한 SaaS 서비스 통합'
---

# Azure 플랫폼에서 사용 가능한 SaaS 서비스 통합

# 랩 답변 키: 서비스 인스턴스를 전체 Azure 솔루션의 구성 요소로 배포

## 시작하기 전에

1. 다음 자격 증명을 사용하여 Windows 10 랩 가상 컴퓨터에 로그인되어 있는지 확인합니다:

    - 사용자 이름: **관리자**

    - 암호: **Pa55w.rd**

1. Windows 10 바탕 화면 하단에 있는 작업 표시줄을 검토합니다. 작업 표시줄에는 랩에서 사용할 일반적인 응용 프로그램에 대한 아이콘이 포함되어 있습니다:

    - Microsoft Edge

    - 파일 탐색기

    - [Visual Studio Code](https://code.visualstudio.com/)

    - [Microsoft Azure Storage Explorer](https://azure.microsoft.com/features/storage-explorer/)

    - Bash on Ubuntu on Windows

    - Windows PowerShell

    > **참고**: 또한 **시작 메뉴** 에서 이러한 응용 프로그램에 대한 바로 가기를 찾을 수 있습니다.

## 연습 1: ARM 템플릿을 사용하여 함수 앱 및 Cognitive 서비스 배포합니다.

#### 작업 1: Azure 포털 열기

1. 작업 표시줄에서 **Microsoft Edge** 아이콘을 클릭합니다.

1. 열린 브라우저 창에서 **Azure 포털** (&https://portal.azure.com>)으로 이동합니다.

1. 메시지가 표시되면 이 랩에서 사용할 Azure 구독의 소유자 역할이 있는 사용자 계정으로 인증합니다.

#### 작업 2: Azure 리소스 관리자 템플릿을 사용하여 Cognitive 서비스 배포

1. Azure 포털의 왼쪽 위 모서리에서 **리소스 만들기** 를 클릭합니다.

1. **새** 블레이드의 맨 위에 **마켓플레이스 검색** 텍스트 상자에서 **템플릿 배포** 를 입력하고 **Enter** 를 누릅니다.

1. **모든** 블레이드에서 검색 결과에서 **템플릿 배포** 를 클릭합니다.

1. **템플릿 배포** 블레이드에서 **만들기** 단추를 클릭합니다.

1. **사용자 지정 배포** 블레이드에서 **편집기에서 사용자 고유의 템플릿 빌드** 링크를 클릭합니다.

1. **템플릿 편집** 블레이드에서 **파일 로드** 를 클릭합니다.

1. 대화 상자 **열기** 에서 **\\allfiles\\AZ-301T01\\Module_02\\LabFiles\\Starter\\** 폴더로 이동하여 **cognitive-template.json** 파일을 선택하고 **열기** 를 클릭합니다. 이렇게 하면 다음 콘텐츠가 템플릿 편집기 창에 로드됩니다:

    ```json
    {
        "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
        "contentVersion": "1.0.0.0",
        "variables": {
            "serviceName": "[concat('cgnt', uniqueString(resourceGroup().id))]"
        },
        "resources": [
            {
                "apiVersion": "2017-04-18",
                "type": "Microsoft.CognitiveServices/accounts",
                "name": "[variables('serviceName')]",
                "kind": "TextAnalytics",
                "location": "[resourceGroup().location]",
                "sku": {
                    "name": "S1"
                },
                "properties": {}
            }
        ],
        "outputs": {
            "cognitiveEndpointUrl": {
                "type": "string",
                "value": "[reference(variables('serviceName')).endpoint]"
            },
            "cognitiveEndpointKey": {
                "type": "string",
                "value": "[listKeys(variables('serviceName'), '2017-04-18').key1]"
            }
        }
    }
    ```

1. **저장** 단추를 클릭하여 템플릿을 유지합니다.

1. **사용자 지정 배포** 블레이드로 돌아가서 다음 작업을 수행합니다:

    - **구독** 드롭다운 목록 항목을 기본값으로 설정합니다.

    - **리소스 그룹** 섹션에서 **새로 만들기** 옵션을 선택한 다음 텍스트 상자에 **AADesignLab1001-RG** 를 입력합니다.

    - **위치**드롭다운 목록에서 이 랩에서 리소스를 배포할 Azure 지역을 선택합니다.

    - **이용 약관** 섹션에서 확인란 **위에 명시된 이용 약관에 동의하는 것** 을 선택합니다.

    - **구입** 단추를 클릭합니다.

1. 배포가 완료될 때까지 기다리고 다음 작업으로 진행합니다. 

1. Azure 포털의 허브 메뉴에서 **리소스 그룹** 을 클릭합니다.

1. **리소스 그룹** 블레이드에서 **AADesignLab1001-RG** 를 클릭합니다.

1. **AADesignLab1001-RG** 블레이드에서 블레이드 상단에 있는 **배포** 헤더를 찾아 **배포** 레이블 아래를 클릭하여 성공적인 배포수를 나타냅니다.

1. 배포 블레이드에서 가장 최근 배포의 이름을 클릭합니다.

1. **Microsoft.Template- 개요** 블레이드에서 **출력** 을 클릭합니다. 

1. **Microsoft.Template - 출력** 블레이드를 통해 **COGNITIVEENDPOINTURL** 및 **COGNITIVEENDPOINTKEY** 출력의 값을 식별합니다. 나중에 랩에서 이러한 값이 필요하므로 이러한 값을 기록합니다.

#### 작업 3: 함수 앱 배포

1. Azure 포털의 왼쪽 위 모서리에서 **리소스 만들기** 를 클릭합니다.

1. **새** 블레이드의 맨 위에 **마켓플레이스 검색** 텍스트 상자에서 **함수 앱** 을 입력하고 **Enter** 를 누릅니다.

1. **모든** 블레이드에서 검색 결과에서 **함수 앱** 을 클릭합니다.

1. **함수 앱** 블레이드에서 **만들기** 단추를 클릭합니다.

1. 다음 **함수 앱** 블레이드에서 다음 작업을 수행합니다:

    - **앱 이름** 텍스트 상자에 전역적으로 고유한 이름을 입력합니다.
    
    - **구독** 드롭다운 목록 항목을 기본값으로 설정합니다.

    - **리소스 그룹** 섹션에서 **기존 사용** 옵션을 선택한 다음 드롭다운 목록에서 **AADesignLab1001-RG** 를 선택합니다.

    - **OS** 섹션에서 **Windows** 단추를 선택해야 합니다.

    - **호스팅 계획** 드롭다운 목록에서 **소비 계획** 항목이 선택되어 있는지 확인합니다.

    - **런타임 스택** 드롭다운 목록에서 **NET** 항목이 선택되어 있는지 확인합니다. 

    - **위치** 드롭다운 목록에서 이전 작업에서 Cognitive 서비스 인스턴스를 배포한 Azure 지역을 선택합니다.

    - **저장소** 섹션에서 **새로 만들기** 옵션을 선택하고 저장소 계정 이름의 기본값을 수락해야 합니다. 

    - **응용 프로그램 인사이트** 섹션에서 확장을 **비활성화** 로 설정합니다.

    - **만들기** 단추를 클릭합니다.

1. 함수 앱 프로비전을 완료될 때까지 기다리고 다음 작업으로 진행합니다. 

1. Azure 포털의 허브 메뉴에서 **리소스 그룹** 을 클릭합니다.

1. **리소스 그룹** 블레이드에서 **AADesignLab1001-RG** 를 클릭합니다.

1. **AADesignLab1001-RG** 블레이드에서 리소스 목록에서 새로 프로비전된 함수 앱을 클릭합니다.

1. 함수 앱 블레이드로 돌아가서 블레이드 상단의 **플랫폼 기능** 탭을 클릭합니다.

1. **플랫폼 기능** 탭에서 **GENERAL SETTINGS** 섹션의 **구성** 링크를 클릭합니다.

1. **응용 프로그램 설정** 탭에서 **응용 프로그램 설정** 섹션을 찾습니다. **새 설정 추가** 링크를 클릭하고 다음 작업을 수행합니다:

    - **이름 입력** 텍스트 상자에 **EndpointUrl** 을 입력합니다.

    - **값 입력** 텍스트 상자에서 식별한 **COGNITIVEENDPOINTURL** 값을 입력합니다.

1. **응용 프로그램 설정** 섹션에서 **새 설정 추가** 링크를 다시 클릭하고 다음 작업을 수행합니다:

    - **이름 입력** 텍스트 상자에 **EndpointKey** 를 입력합니다.

    - **값 입력** 텍스트 상자에서 앞에서 식별한 **COGNITIVEENDPOINTKEY** 값을 입력합니다.

1. **응용 프로그램 설정** 탭 상단의 **저장** 단추를 클릭합니다.

1. 함수 앱 블레이드로 돌아가서 블레이드 상단의 **플랫폼 기능** 탭을 클릭합니다.

1. **플랫폼 기능** 탭에서 **코드 배포** 섹션에서 **배포 센터** 링크를 클릭합니다.

1. 나타나는 **배포 센터** 블레이드에서 **외부** 단추를 클릭한 다음 **계속** 을 클릭합니다.

1. **앱 서비스 빌드 서버** 를 클릭하고 **계속** 을 클릭합니다. 

1. **코드** 섹션이 표시되면 다음 작업을 수행합니다

    - **리포지토리 URL** 텍스트 상자에서 **https://github.com/azure-labs/cognitive-services-function** 을 입력합니다.

    - **분기** 텍스트 상자에서 **마스터** 를 입력합니다.
    
        > **참고**: 분기 필드는 대/소문자를 구분합니다.

    - **리포지토리 유형** 섹션에서 **Git** 단추를 선택해야 합니다.

    - **계속** 단추를 클릭합니다.

1. **종료**를 클릭하고 배포가 완료될 때까지 기다리고 다음 작업으로 진행합니다. 

    > **참고**: **배포** 탭을 모니터링하여 첫 번째 배포가 완료되었는지 확인할 수 있습니다. 이 탭은 자동으로 업데이트됩니다.

#### 작업 4: Cognitive 서비스를 사용하여 함수 앱 테스트

1. 함수 앱 블레이드로 돌아가서 **함수** 를 클릭하여 함수 목록을 확장합니다.

    > **참고**: **함수 목록을 새로** 고치려면 함수를 두 번 클릭해야 할 수 있습니다.

1. 함수 목록에서 **결정 언어** 함수를 선택합니다.

1. 열리는 **run.csx** 창에서 창의 오른쪽에 있는 **테스트** 를 클릭합니다.

1. **테스트** 창에서 단계에서 다음 작업을 수행합니다:

    - **요청 본문** 텍스트 상자에 다음을 입력합니다.

    ```json
    {
        "text": "저는 오래된 카펫 가방에 셔츠를 한두 개 넣고 팔 아래에 집어 넣고 케이프 혼과 태평양을 위해 시작했습니다."
    }
    ```

    - **실행** 단추를 클릭합니다.

    - **출력** 섹션에서 출력을 검토합니다. 출력은 언어를 **en**(영어)으로 식별해야 합니다.

> **검토**: 이 연습에서는 Azure Cognitive 서비스를 사용하는 함수 앱을 만들었습니다.


## 연습 2: 함수 앱을 사용하는 논리 앱 만들기

#### 작업 1: 논리 앱 만들기

1. Azure 포털의 왼쪽 위 모서리에서 **리소스 만들기** 를 클릭합니다.

1. **새** 블레이드의 맨 위에 **마켓플레이스 검색** 텍스트 상자에서 **논리 앱** 을 입력하고 **Enter** 를 누릅니다.

1. **모든** 블레이드에서 검색 결과에서 **논리 앱** 을 클릭합니다.

1. **함수 앱** 블레이드에서 **만들기** 단추를 클릭합니다.

1. **논리 앱 만들기** 블레이드에서 다음 작업을 수행합니다:

    - **이름** 텍스트 상자에 **CognitiveWorkflow** 값을 입력합니다.
    
    - **구독** 드롭다운 목록 항목을 기본값으로 설정합니다.

    - **리소스 그룹** 섹션에서 **기존 사용** 옵션을 선택한 다음 드롭다운 목록에서 **AADesignLab1001-RG** 를 선택합니다.

    - **위치** 드롭다운 목록에서 이 랩의 이전 연습에서 선택한 것과 동일한 Azure 지역을 선택합니다. 

    - **로그 분석** 섹션에서 **끄기** 단추를 선택해야 합니다.

    - **만들기** 단추를 클릭합니다.

1. 프로비전이 완료될 때까지 기다리고 다음 작업으로 진행합니다. 

#### 작업 2: 논리 앱 단계 구성

1. Azure 포털의 허브 메뉴에서 **리소스 그룹** 을 클릭합니다.

1. **리소스 그룹** 블레이드에서 **AADesignLab1001-RG** 를 클릭합니다.

1. **AADesignLab1001-RG** 블레이드에서 이전 연습에서 만든 키 자격 증명 모음을 나타내는 항목을 클릭합니다.

1. **논리 앱 디자이너** 블레이드에서 아래로 스크롤하여 **템플릿** 섹션에서 **빈 논리 앱** 타일을 클릭합니다.

1. **논리 앱 디자이너** 블레이드에서 창 상단의 **코드 보기** 단추를 클릭합니다.

1. **논리 앱 디자이너** 블레이드에서 빈 논리 앱 JSON 템플릿을 검토합니다:

    ```json
    {
        "definition": {
            "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
            "actions": {},
            "contentVersion": "1.0.0.0",
            "outputs": {},
            "parameters": {},
            "triggers": {}
        }
    }
    ```

1. 기본 JSON 템플릿을 HTTP 트리거가 포함된 다음 템플릿으로 바꿉니다 (**\\\allfiles\\allfiles\301T01\Module_01\LabFiles\\\\\\logic-app.json**):

    ```json
    {
        "definition": {
            "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
            "actions": {},
            "contentVersion": "1.0.0.0",
            "outputs": {},
            "parameters": {},
            "triggers": {
                "manual": {
                    "inputs": {
                        "method": "POST",
                        "schema": {
                            "properties": {
                                "text": {
                                    "type": "string"
                                }
                            },
                            "type": "object"
                        }
                    },
                    "kind": "Http",
                    "type": "Request"
                }
            }
        }
    }
    ```

1. **논리 앱 디자이너** 블레이드에서 **디자이너** 단추를 클릭합니다.

    > **참고**: 이 시점에서 디자이너에 단일 단계가 표시 됩니다. 워크플로를 시작하는 "트리거" 단계입니다.

1. 디자이너에서 **+ 새 단계** 단추를 클릭합니다.

1. **작업 선택** 섹션에서 다음 작업을 수행합니다:

    - 검색 텍스트 상자에서 **Azure 함수** 를 입력합니다.

    - 검색 결과에서 **Azure 함수 선택** 이라는 작업을 선택합니다.

    - 다음 검색 결과 집합에서 이 랩의 이전 연습에서 만든 Azure 함수 인스턴스를 선택합니다.

    - 검색 결과의 마지막 집합에서 작업에 사용할 **결정 언어** 함수를 선택합니다.

1. **결정 언어** 단계에서 다음 작업을 수행합니다:

    - **고급 옵션 표시** 링크를 클릭하여 모든 옵션을 표시합니다.

    - **요청 본문** 텍스트 상자에 **@triggerBody()** 를 입력합니다.

    - **메서드** 드롭다운 목록에서 **POST** 옵션을 선택합니다.

1. 디자이너에서 **+ 새 단계** 단추를 클릭합니다. **작업 만들기** 를 위한 대화 상자를 열려면 작업 추가 단추를 클릭합니다.

1. **작업 선택** 섹션에서 다음 작업을 수행합니다:

    - 검색 텍스트 상자에서 **Azure 함수** 를 입력합니다.

    - 검색 결과에서 **Azure 함수 선택** 이라는 작업을 선택합니다.

    - 다음 검색 결과 집합에서 이 랩의 이전 연습에서 만든 Azure 함수 인스턴스를 선택합니다.

    - 검색 결과의 마지막 집합에서 작업에 사용할 **결정 KeyPhrases** 함수를 선택합니다.

1. **결정 KeyPhrases** 단계에서 다음 작업을 수행합니다:

    - **고급 옵션 표시** 링크를 클릭하여 모든 옵션을 표시합니다.

    - **요청 본문** 텍스트 상자에 **@body(’결정 언어’)** 값을 입력합니다.

    - **메서드** 드롭다운 목록에서 **POST** 옵션을 선택합니다.

1. 디자이너에서 **+ 새 단계** 단추를 클릭합니다. 

1. **작업 선택** 섹션에서 다음 작업을 수행합니다:

    - 검색 텍스트 상자에서 **응답** 을 입력합니다.

    - 검색 결과에서 **응답 요청** 이라는 **작업** 을 선택합니다.

1. **응답** 단계에서 다음 작업을 수행합니다:

    - **상태 코드** 텍스트 상자에서 값 **200** 을 지정해야 합니다.

    - **본문** 텍스트 상자에 **@body(’DetermineKeyPhrases’)** 를 입력합니다.

1. **논리 앱 디자이너** 블레이드 상단에서 **저장** 단추를 클릭하여 워크플로를 유지합니다.

1. **논리 앱 디자이너** 영역의 맨 위로 스크롤하여 **HTTP 요청이 수신된 경우** 단계를 클릭합니다.

1. **HTTP POST URL** 텍스트 상자의 값을 복사합니다. 이 URL은 이 랩의 나중에 사용됩니다.

#### 작업 2: Cloud Shell 열기

1. 포털 상단에서 **Cloud Shell** 아이콘을 클릭하여 새 셸 인스턴스를 엽니다.

    > **참고**: **Cloud Shell** 아이콘은 *보다 큰* 문자와 *밑줄* 문자의 조합으로 구성된 기호입니다.

1. 구독을 사용하여 **Cloud Shell** 을 처음 여는 경우 처음 사용할 수 있도록 **Cloud Shell** 을 구성하는 마법사가 표시됩니다. 메시지가 표시되면 **Azure Cloud Shell에 오신 것을 환영합니다** 창에서 **Bash (Linux)** 를 클릭합니다.

    > **참고**: **Cloud Shell** 에 대한 구성 옵션이 표시되지 않으면 이 과정의 랩에서 기존 구독을 사용하고 있기 때문일 수 있습니다. 그렇다면 다음 작업으로 직접 진행합니다. 

1. **마운트된 저장소가 없습니다** 창에서 **고급 설정 표시** 를 클릭하고 다음 작업을 수행합니다:

    - **구독** 드롭다운 목록 항목을 기본값으로 설정합니다.

    - **Cloud Shell 지역** 드롭다운 목록에서 일치하는 Azure 지역 또는 이 랩에서 리소스를 배포한 위치 근처에서 선택합니다.

    - **리소스 그룹** 섹션에서 **기존 사용** 옵션을 선택한 다음 드롭다운 목록에서 **AADesignLab1001-RG** 를 선택합니다.

    - **저장소 계정** 섹션에서 **새로 만들기** 옵션을 선택한 다음 아래 텍스트 상자에 3~24자및 숫자로 구성된 고유한 이름을 입력합니다. 

    - **파일 공유** 섹션에서 **새로 만들기** 옵션을 선택한 다음 아래 텍스트 상자에 **cloudshell** 을 입력합니다.

    - **저장소 만들기** 단추를 클릭합니다.

1. 다음 작업을 진행하기 전에 **Cloud Shell** 이 처음 설치 절차를 완료할 때까지 기다립니다.

#### 작업 3: Python을 사용하여 논리 앱 유효성 검사

1. 포털 하단의 **Cloud Shell** 명령 프롬프트에서 다음 명령을 입력하고 **Enter** 를 눌러 대화형 **python** 터미널을 엽니다:

    ```
    python
    ```

1. 포털 하단의 **Cloud Shell** 명령 프롬프트에서 다음 명령을 입력하고 **Enter** 를 눌러 **요청** 라이브러리를 가져옵니다:

    ```python
    import requests
    ```

1. 포털 하단의 **Cloud Shell** 명령 프롬프트에서 다음 명령을 입력합니다(자리 표시자 `<logic 앱 POST Url>`를 이 랩의 앞에 기록된 URL 값으로 대체)을 입력하고 **Enter** 를 눌러 포함 된변수를 만듭니다. 논리 앱 URL의 값 :

    ```python
    url = "<logic app POST Url>"
    ```

1. 포털 하단의 **Cloud Shell** 명령 프롬프트에서 다음 명령을 입력하고 **Enter** 를 눌러 HTTP POST 요청을 보내 논리 앱 워크플로를 트리거합니다:

    ```python
    response = requests.post(url, json={'text': '꿈꾸는 Sabbath 오후의 도시를 돌이키라. 콜리어스 후크에서 코엔티스 슬립으로 이동, 그리고 그 때부터, 화이트 홀에 의해, 북쪽으로.'})
    ```

1. 포털 하단의 **Cloud Shell** 명령 프롬프트에서 다음 명령을 입력하고 **Enter** 를 눌러 논리 앱 워크플로의 출력을 표시합니다:

    ```python
    print(response.status_code, response.reason, response.text)
    ```

1.  **Cloud Shell** 창을 닫습니다.

> **검토**: 이 연습에서는 이 랩의 이전 연습에서 만든 함수 앱을 활용하는 논리 앱을 만들었습니다.

## 연습 3: 랩 리소스 제거

#### 작업 1: Cloud Shell 열기

1. 포털 상단에서 **Cloud Shell** 아이콘을 클릭하여 Clould Shell 창을 엽니다.

1. **Cloud Shell** 명령 프롬프트에서 다음 명령을 입력하고 **Enter** 를 눌러 이 랩에서 만든 모든 리소스 그룹을 나열합니다:

    ```
    az group list --query "[?starts_with(name,'AADesignLab10')]".name --output tsv
    ```

1. 출력에 이 랩에서 만든 리소스 그룹만 포함되어 있는지 확인합니다. 이러한 그룹은 다음 작업에서 삭제됩니다.

#### 작업 2: 리소스 그룹 삭제

1. **Cloud Shell** 명령 프롬프트에서 다음 명령을 입력하고 **Enter** 를 눌러 이 랩에서 만든 리소스 그룹을 삭제합니다.

    ```sh
    az group list --query "[?starts_with(name,'AADesignLab10')]".name --output tsv | xargs -L1 bash -c 'az group delete --name $0 --no-wait --yes'
    ```

1. 포털 하단의 **Cloud Shell** 프롬프트를 닫습니다.

> **검토**: 이 연습에서는 이 랩에서 사용된 리소스를 제거했습니다.
