---
lab:
    title: 'Azure 리소스 간의 통신을 용이하게 하기 위한 메시징 구성 요소 배포'
    module: '모듈 4: 메시징 서비스를 사용하여 Azure 솔루션 구성 요소 통합'
---

# 메시징 서비스를 사용하여 Azure 솔루션 구성 요소 통합

# 랩 답변 키: Azure 리소스 간의 통신을 용이하게 하기 위한 메시징 구성 요소 배포

## 시작하기 전에

1. 다음 자격 증명을 사용하여 Windows 10 랩 가상 컴퓨터에 로그인되어 있는지 확인합니다.

    - 사용자 이름: **관리자**

    - 암호: **Pa55w.rd**

1. Windows 10 바탕 화면 하단에 있는 작업 표시줄을 검토합니다. 작업 표시줄에는 랩에서 사용할 일반적인 응용 프로그램 아이콘이 포함되어 있습니다.

    - Microsoft Edge

    - 파일 탐색기

    - [Visual Studio Code](https://code.visualstudio.com/)

    - [Microsoft Azure 스토리지 탐색기](https://azure.microsoft.com/features/storage-explorer/)

    - Bash on Ubuntu on Windows

    - Windows PowerShell

    > **참고**: **시작 메뉴** 에서 이 응용프로그램에 대한 바로 가기를 찾을 수도 있습니다.

## 실습 1: Service Bus 네임스페이스 배포

#### 작업 1: Azure Portal 열기

1. 작업 표시줄에서 **Microsoft Edge** 아이콘을 클릭합니다. 

1. 열려 있는 브라우저 창에서 **Azure Portal**(<https://portal.azure.com>)로 이동합니다.

1. 메시지가 표시되면 이 랩에서 사용할 Azure 구독의 소유자 역할이 있는 사용자 계정으로 인증합니다.

#### 작업 2: Service Bus 네임스페이스 생성하기

1. Azure Portal의 왼쪽 상단 모서리에서 **리소스 생성하기** 를 클릭합니다.

1. **마켓플레이스 검색** 텍스트 상자의 **신규** 블레이드 상단에 **Service Bus** 를 입력하고 **엔터** 를 누릅니다.

1. **전체** 블레이드의 검색 결과에서 **Service Bus** 를 클릭합니다.

1. **Service Bus** 블레이드에서 **생성하기** 버튼을 클릭합니다.

1. **네임스페이스 생성하기** 블레이드에서 다음 작업을 수행합니다.

    - **이름** 텍스트 상자에 전체적으로 고유한 이름을 입력합니다. 

    - **가격 계층** 드롭다운 목록에서 **기본** 옵션을 선택합니다. 
    
    - **구독** 드롭다운 목록 항목을 기본값 설정으로 유지합니다. 

    - **리소스 그룹** 섹션에서 **새로 생성하기** 옵션을 선택한 다음 텍스트 상자에 **AADesignLab1101-RG** 를 입력합니다.

    - **위치** 드롭다운 목록에서 이 랩에서 리소스를 배포할 Azure 지역을 선택합니다. 

    - **생성하기** 버튼을 클릭합니다.

1. 다음 단계로 진행하기 전에 프로비저닝이 완료될 때까지 기다립니다. 

#### 작업 3: Sevice Bus 큐 생성하기

1. Azure Portal의 허브 메뉴에서 **리소스 그룹** 을 클릭합니다.

1. **리소스 그룹** 블레이드에서 **AADesignLab1101-RG** 를 클릭합니다. 

1. **AADesignLab1101-RG** 블레이드에서 새로 생성된 Service Bus 네임스페이스를 클릭합니다. 

1. Service Bus 네임스페이스 블레이드에 있는 **ENTITIES** 섹션에서 **큐** 를 클릭합니다.

1. Service Bus 네임스페이스 블레이드에서 **+ 큐** 버튼을 클릭합니다.

1. **큐 생성하기** 창에서 다음 작업을 수행합니다.

    - **이름** 텍스트 상자에 **메시지** 를 입력합니다.

    - 다른 모든 설정은 기본값을 유지합니다.

    - **생성하기** 버튼을 클릭합니다.

#### 작업 4: Srvice Bus 연결 문자열 가져오기

1. Service Bus 네임스페이스 블레이드에서 **공유된 액세스 정책** 을 클릭합니다.

1. Service Bus 네임스페이스 블레이드에서 **RootManageSharedAccessKey** 정책을 클릭합니다.

1. **SAS 정책: RootManageSharedAccessKey** 창에서 **기본 연결 문자열** 필드의 값을 찾아 기록합니다. 나중에 이 랩에서 이 값을 사용하게 됩니다.

> **검토**: 이 연습에서는 새 Service Bus 네임스페이스를 만들고 네임스페이스의 큐에 액세스하는 연결 문자열을 기록했습니다.

## 실습 2: 논리 앱 생성하기

#### 작업 1: Azure 스토리지 계정 생성하기

1. Azure Portal의 왼쪽 상단 모서리에서 **리소스 생성하기** 를 클릭합니다.

1. **마켓플레이스 검색** 텍스트 상자의 **신규** 블레이드 상단에 **스토리지 계정** 을 입력하고 **엔터** 를 누릅니다.

1. **전체** 블레이드의 검색 결과에서 **스토리지 계정** 을 클릭합니다.

1. **스토리지 계정** 블레이드에서 **생성하기** 버튼을 클릭합니다.

1. **스토리지 계정 생성하기** 블레이드에서 다음 작업을 수행하십시오.

    - **이름** 텍스트 상자에 3~24개 글자와 숫자로 구성된 고유한 이름을 입력합니다.
    
    - **배포 모델** 섹션에서 **리소스 관리자** 옵션이 선택되어 있는지 확인합니다. 

    - **계정 종류** 드롭다운 목록에서 **스토리지(일반 목적 v1)** 옵션이 선택되어 있는지 확인합니다. 

    - **위치** 항목을 이 실습 초반에 선택한 것과 동일한 Azure 지역 설정으로 유지합니다.

    - **복제** 드롭다운 목록에서 **LRS(Locally-redundant storage)** 항목을 선택합니다. 

    - **성능** 섹션에서 **표준** 옵션이 선택되어 있는지 확인합니다. 

    - **보안 전송 필수** 섹션에서 **비활성** 옵션이 선택되어 있는지 확인합니다.  

    - **구독** 드롭다운 목록 항목을 기본값 설정으로 유지합니다.

    - **리소스 그룹** 섹션에서 **기존 리소스 사용** 옵션이 선택되었는지 확인한 다음, 아래의 드롭다운 목록에서 이전에 진행한 실습에서 생성한 리소스 그룹을 선택하십시오.

    - **가상 네트워크 구성** 옵션을 기본값 설정으로 유지합니다. 

    - **계층적 네임스페이스** 옵션을 기본값 설정으로 유지합니다. 

    - **생성하기** 버튼을 클릭합니다.

1. 다음 단계로 진행하기 전에 프로비저닝이 완료될 때까지 기다립니다.

1. Azure Portal의 허브 메뉴에서 **리소스 그룹** 을 클릭합니다.

1. **리소스 그룹** 블레이드에서 **AADesignLab1101-RG** 를 클릭합니다.

1. **AADesignLab1101-RG** 블레이드에서 새로 생성된 Azure 스토리지 계정을 클릭합니다.  

1. 스토리지 계정 블레이드에서 **Blobs** 타일을 클릭합니다. 

1. 스토리지 계정 블레이드에서 **+ 컨테이너** 버튼을 클릭합니다.

1. **새 컨테이너** 창에서 다음 작업을 수행합니다. 

    - **이름** 텍스트 상자에 **messageoutput** 을 입력합니다.

    - **공용 액세스 수준** 드롭다운 목록에서 **Blob(Blobs 전용 익명 읽기 액세스)** 옵션을 선택합니다.

    - **확인** 버튼을 클릭합니다.

#### 작업 2: 논리 앱 생성하기

1. **마켓플레이스 검색** 텍스트 상자의 **신규** 블레이드 상단에서 **논리 앱** 을 입력하고 **엔터** 를 누릅니다.

1. **전체** 블레이드의 검색 결과에서 **논리 앱** 을 클릭합니다.

1. **논리 앱** 블레이드에서 **생성하기** 버튼을 클릭합니다.

1. **논리 앱 생성하기** 블레이드에서 다음 작업을 수행하십시오.

    - **이름** 텍스트 상자에 **ServiceBusWorkflow** 를 입력합니다.
    
    - **구독** 드롭다운 목록 항목을 기본값 설정으로 유지합니다.

    - **리소스 그룹** 섹션에서 **기존 리소스 사용** 옵션을 선택한 다음, 드롭다운 목록에서 **AADesignLab1101-RG** 를 선택합니다.

    - **위치** 드롭다운 목록에서 이전 작업에서 선택한 것과 동일한 Azure 지역을 선택합니다.  

    - **로그 분석** 섹션에서 **꺼짐** 버튼을 선택해야 합니다. 

    - **생성하기** 버튼을 클릭합니다.

1. 다음 작업을 진행하기 전에 프로비저닝이 완료될 때까지 기다립니다. 

#### 작업 3: 논리 앱 단계를 구성합니다.

1. Azure Portal의 허브 메뉴에서 **리소스 그룹** 을 클릭합니다.

1. **리소스 그룹** 블레이드에서 **AADesignLab1101-RG** 를 클릭합니다.

1. **AADesignLab1101-RG** 블레이드에서 이전 작업에서 만든 논리 앱을 나타내는 항목을 클릭합니다. 

1. **논리 앱 디자이너** 블레이드에서 아래로 스크롤하여 **템플릿** 섹션에서 **빈 논리 앱** 을 클릭합니다.

1. **논리 앱 디자이너** 블레이드에서 다음 작업을 수행합니다.

    - **커넥터 및 트리거 검색** 텍스트 상자에 **Service Bus** 를 입력합니다.

    - 검색 결과에서 **큐에 메시지를 수신한 경우(자동 완성) - Service Bus** 라는 이름의 트리거를 선택합니다.

    - **연결 이름** 텍스트 상자에 **ServiceBusConnection** 을 입력합니다. 
    
    - **Service Bus 네임스페이스** 목록에서 이 랩의 앞에서 만든 네임스페이스를 선택합니다. 

    - 정책 목록에서 **RootManageSharedAccessKey** 정책을 선택합니다.

    - **생성하기** 버튼을 클릭합니다.

1. **큐에 메시지를 수신한 경우(자동 완성)** 단계에서 다음 작업을 수행합니다. 

    - **큐 이름** 드롭다운 목록에서 **메시지** 항목을 선택합니다. 

    - **간격** 텍스트 상자에 **30** 을 입력합니다.

    - **빈도수** 드롭다운 목록에서 **두 번째** 항목을 선택합니다. 

1. **논리 앱 디자이너** 블레이드에서 **+ 새 단계** 버튼을 클릭합니다.

1. **논리 앱 디자이너** 블레이드에서 다음 작업을 수행합니다.

    - **커넥터 및 조치 검색** 텍스트 상자에 **스토리지 blob** 을 입력합니다.

    - 검색 결과에서 **Blob 생성하기 - Azure Blob 스토리지** 라는 이름의 행동을 선택합니다.

    - **연결 이름** 텍스트 상자에 **StorageConnection** 을 입력합니다.
    
    - *스토리지 계정* 목록에서 이 랩의 앞에서 만든 계정을 선택합니다. 

    - **생성하기** 버튼을 클릭합니다.  

1. **Blob 생성하기** 단계에서 다음 작업을 수행합니다.

    - **폴더 경로** 텍스트 상자에 **/messageoutput** 을 입력합니다.

    - **Blob 이름** 텍스트 상자에 **@concat(triggerBody()?['MessageId], '.txt')** 를 입력합니다.

    - **Blob 콘텐츠** 텍스트 상자에 **@string(decodeBase64(triggerBody()?['ContentData']))** 를 입력합니다.

1. **논리 앱 디자이너** 블레이드 상단에서 **저장** 버튼을 클릭하여 워크플로를 지속합니다.

#### 작업 2: Cloud Shell 열기

1. 포털 상단에서 **Cloud Shell** 아이콘을 클릭하여 새 셸 인스턴스를 엽니다.

    > **참고**: **Cloud Shell** 아이콘은 *초과* 와 *밑줄* 문자의 조합으로 구성된 기호입니다. 

1. 구독을 사용하여 **Cloud Shell** 을 처음 여는 경우, 처음에만 사용할 수 있도록 **Cloud Shell** 을 구성하는 마법사가 표시됩니다. 메시지가 표시되면 **Azure Cloud Shell 환영** 창에서 **Bash(Linux)** 를 클릭합니다.

    > **참고**: **Cloud Shell** 에 대한 구성 옵션이 표시되지 않은 경우, 대부분은 이 과정의 랩에서 기존 구독을 사용하고 있기 때문일 수 있습니다. 그런 경우, 다음 작업으로 직접 진행합니다. 

1. **장착된 스토리지가 없습니다** 창에서 **고급 설정 보기** 를 클릭한 다음, 다음 작업을 수행합니다.

    - **구독** 드롭다운 목록 항목을 기본값 설정으로 유지합니다.

    - **Cloud Shell 지역** 드롭다운 목록에서 이 랩에서 리소스를 배포했던 위치와 일치 또는 근처에 있는 Azure 지역을 선택합니다.

    - **리소스 그룹** 섹션에서 **기존 리소스 사용** 옵션을 선택한 다음, 드롭다운 목록에서 **AADesignLab1101-RG** 를 선택합니다.

    - **스토리지 계정** 섹션에서 **새로 생성하기** 옵션을 선택한 다음 아래 텍스트 상자에 3~24개 문자와 숫자로 구성된 고유한 이름을 입력합니다. 

    - **파일 공유** 섹션에서 **새로 생성하기** 옵션을 선택한 다음 아래 텍스트 상자에 **cloudshell** 을 입력합니다.

    - **스토리지 생성하기** 버튼을 클릭합니다.

1. 다음 작업을 진행하기 전에 **Cloud Shell** 이 첫 번째 설치 절차를 완료할 때까지 기다립니다.

#### 작업 4: Node.js를 사용하여 논리 앱 유효성 검사

1. 포털 상단에서 **Cloud Shell** 아이콘을 클릭하여 새 셸 인스턴스를 엽니다.

1. 포털 하단에 있는 **Cloud Shell** 명령 프롬프트에 다음 명령을 입력하고 **엔터** 를 눌러 NPM을 사용하여 **Azure** 패키지를 설치합니다.

    ```sh
    npm install azure
    ```

1. **Cloud Shell** 명령 프롬프트에 다음 명령을 입력하고 **엔터** 를 눌러 대화형 노드 터미널을 엽니다.

    ```sh
    노드
    ```

1. **Cloud Shell** 명령 프롬프트에 다음 명령을 입력하고 **엔터** 를 눌러 노드에 **azure** 모듈을 불러옵니다.

    ```sh
    var azure = require('azure');
    ```
    > **참고**: **무작위적으로** 보이도록 출력됩니다. 이는 예상된 것입니다.
    
1. **Cloud Shell** 명령 프롬프트에서 다음 명령(placeholder `<Service Bus namespace connection string>`을 랩의 앞에서 기록한 URL 값으로 대체)을 입력한 다음, **신규** 를 눌러 Service Bus 네임스페이스 연결 문자열을 위한 새 변수를 만듭니다.

    ```sh
    var connectionString = '<Service Bus namespace connection string>';
    ```

1. **Cloud Shell** 명령 프롬프트에 다음 명령을 입력하고 **엔터** 를 눌러 Service Bus 네임스페이스에 연결할 새 클라이언트를 만듭니다.

    ```sh
    var serviceBusService = azure.createServiceBusService(connectionString);
    ```

1. **Cloud Shell** 명령 프롬프트에 다음 명령을 입력하고 **엔터** 를 눌러 클라이언트를 사용하여 Service Bus 네임스페이스 큐에 메시지를 전송합니다.

    ```sh
    serviceBusService.sendQueueMessage('messages', { body: 'Hello World' }, function(error) { console.log(error) });    
    ```

1. Azure Portal의 허브 메뉴에서 **리소스 그룹** 을 클릭합니다.

1. **리소스 그룹** 블레이드에서 **AADesignLab1101-RG** 를 클릭합니다.

1.  **AADesignLab1101-RG** 블레이드에서 이 랩의 앞에서 만든 Azure 스토리지 계정을 클릭합니다. 

1. 스토리지 계정 블레이드에서 **Blobs** 타일을 클릭합니다. 

1. 스토리지 계정 컨테이너 블레이드에서 **messageoutput** 컨테이너를 클릭합니다.

1. 컨테이너에서 새로 만든 blob에 주목하십시오.

> **검토**: 이 실습에서는 Service Bus 네임스페이스에 있는 큐의 메시지를 통해 촉발되는 논리 앱을 만들었습니다.

## 실습 3: 랩 리소스 제거

#### 작업 1: Cloud Shell 열기

1. 포털 상단에서 **Cloud Shell** 아이콘을 클릭하여 Cloud Shell 창을 엽니다. 

1. **Cloud Shell** 명령 프롬프트에 다음 명령을 입력하고 **엔터** 를 눌러 이 랩에서 만든 모든 리소스 그룹을 나열합니다. 

    ```sh
    az group list --query "[?starts_with(name,'AADesignLab11')]".name --output tsv
    ```

1. 출력에 이 랩에서 만든 리소스 그룹만 포함되어 있는지 확인합니다. 이러한 그룹은 다음 작업에서 삭제됩니다.

#### 작업 2: 리소스 그룹 삭제

1. **Cloud Shell** 명령 프롬프트에 다음 명령을 입력하고 **엔터** 를 눌러 이 랩에서 만든 리소스 그룹을 삭제합니다.

    ```sh
    az group list --query "[?starts_with(name,'AADesignLab11')]".name --output tsv | xargs -L1 bash -c 'az group delete --name $0 --no-wait --yes'
    ```

1. 포털 하단에 있는 **Cloud Shell** 프롬프트를 닫습니다.

> **검토**: 이 실습에서는 이 랩에서 사용된 리소스를 제거했습니다.
